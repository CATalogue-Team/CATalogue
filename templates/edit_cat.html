
{% extends "base.html" %}

{% block content %}
<h2>编辑猫咪信息</h2>
<form method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    <div class="form-group">
        {{ form.name.label }}
        {{ form.name(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.description.label }}
        {{ form.description(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.image.label }}
        {{ form.image(class="form-control", id="imageUpload") }}
        <div class="image-preview mt-2">
            {% if cat['image'] %}
            <p>当前图片:</p>
            <img id="currentImage" src="{{ url_for('static', filename='uploads/' + cat['image']) }}" width="200" class="img-thumbnail">
            {% else %}
            <p>暂无图片</p>
            <img id="currentImage" style="display:none;" width="200" class="img-thumbnail">
            {% endif %}
            <img id="imagePreview" style="display:none;" width="200" class="img-thumbnail">
        </div>
    </div>
    <button type="submit" class="btn btn-primary">保存</button>
    <a href="{{ url_for('admin_cats') }}" class="btn btn-secondary">取消</a>
</form>

<script>
document.getElementById('imageUpload').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('currentImage').style.display = 'none';
            const preview = document.getElementById('imagePreview');
            preview.src = e.target.result;
            preview.style.display = 'block';
        }
        reader.readAsDataURL(file);
    }
});
</script>
{% endblock %}
